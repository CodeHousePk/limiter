/*
 * Shopify.Cart object.
 * version: 1.0 (29/05/2011)
 * @requires any version of jQuery
 *
 * Copyright 2011 Caroline Hill <mllegeorgesand@gmail.com>
 *
 * To use in Shopify to limit quantities of products ordered.
 *
 * STEP 1: Upload the file jquery.limit.min.js to your theme assets on the Template Editor page.
 *
 * STEP 2: Add the following code to your theme.liquid layout file before the closing body tag.
 * (You could add the code to the head element, but for a tiny performance gain add it at bottom.)
 *
 * {{ 'jquery.limit.min.js' | asset_url | script_tag }}
 * <script>
 * Shopify.Cart.config();
 * </script>
 *
 * Configuration parameters are all optional.
 *
 * You pass an object to Shopify.Cart.config().
 *
 * The keys are...
 *
 * limitQuantity: a number, can be set to 0, 1, 2, 3 and up. Use 0 if you want to disable purchase.
 * Default if not specified is 1.
 *
 * limitPer: that on which the limit is imposed. Use 'product', 'variant' or 'order'.
 * Default if not specified is 'product'.
 *
 * limitProductHandles: an array of product handles. If you don't set that parameter, 
 * the limit is imposed on every product in your shop. Default is an empty array.
 *
 * limitSkipCartPage: a boolean. True if you want customer to skip the cart page and go directly 
 * to the checkout when he adds something to the cart.  Default is false.
 *
 * Shopify.Cart.config(); will limit quantities purchased to 1 per product.
 *
 * Need something different?
 *
 * Example 1: Limiting to 3 items per product, so you can buy a max of 3 items of the same product, 
 * same or different variants of it:
 *
 * {{ 'jquery.limit.min.js' | asset_url | script_tag }}
 * <script>
 * Shopify.Cart.config({ limitQuantity: 3, limitPer: 'product' });
 * </script>
 *
 * Example 2: Limiting to 1 item per variant, so customer can buy 1 variant of a product 
 * and 1 other variant of same product:
 *
 * {{ 'jquery.limit.min.js' | asset_url | script_tag }}
 * <script>
 * Shopify.Cart.config({ limitQuantity: 1, limitPer: 'variant' });
 * </script>
 *
 * Example 3: You have a promo for a product with handle turtles-box and 
 * want to limit quantities to 4 per order just for that product:
 *
 * {{ 'jquery.limit.min.js' | asset_url | script_tag }}
 * <script>
 * Shopify.Cart.config({ limitQuantity: 4, limitPer: 'product', limitProductHandles: ['turtles-box'] });
 * </script>
 *
 * Example 4: You sell only one product in your shop, and customers will only want to buy 1 of it:
 *
 * {{ 'jquery.limit.min.js' | asset_url | script_tag }}
 * <script>
 * Shopify.Cart.config({ limitQuantity: 1, limitPer: 'order', limitSkipCartPage: true });
 * </script>
 *
 */

if((typeof Shopify)==="undefined"){Shopify={}}

Shopify.Cart=(function(){var c={limitQuantity:1,limitPer:"product",limitProductHandles:[],limitSkipCartPage:false};var a="";var h=0;var d={};var f={};var e={};var g=function(k){if(k.constructor.toString().indexOf("Array")===-1){return false}else{return true}};var b=function(k){if(c.limitProductHandles.length){if(jQuery.inArray(k,c.limitProductHandles)===-1){return false}else{return true}}else{return true}};var j=function(){var k=false;jQuery("[name^=updates]").each(function(){var m=parseInt(jQuery(this).attr("id").replace("updates_",""),10);if(b(f[m])){switch(c.limitPer){case"product":if(k==false){var n=parseInt(jQuery(this).val(),10);var l=c.limitQuantity;l-=d[f[m]];l+=n;if(n>l){k=true;jQuery(this).val(Math.max(0,l))}}break;case"variant":if(parseInt(jQuery(this).val(),10)>c.limitQuantity){k=true;jQuery(this).val(c.limitQuantity)}break;case"order":if(k==false){var n=parseInt(jQuery(this).val(),10);var l=c.limitQuantity;l-=h;l+=n;if(n>l){k=true;jQuery(this).val(Math.max(0,l))}}break}}});if(k){jQuery('form[action="/cart"]').get(0).submit()}};var i=function(){var k=window.location.pathname;if(k.indexOf("/products/")!==-1){jQuery.ajaxSetup({cache:false});a=k.match(/\/products\/([a-z0-9\-]+)/)[1]}if(k.indexOf("/products/")!==-1||k==="/cart"){jQuery.getJSON("/cart.js",function(n){var l=n.items;h=n.item_count;for(var m=0;m<l.length;m++){if(typeof d[l[m].handle]==="undefined"){d[l[m].handle]=l[m].quantity}else{d[l[m].handle]+=l[m].quantity}f[l[m].id]=l[m].handle;e[l[m].id]=l[m].quantity}if(k==="/cart"){j()}})}jQuery(function(){jQuery('form[action="/cart/add"]').unbind("submit").submit(function(p){if(b(a)){var o=jQuery(this).find("[name=quantity]");var q=parseInt(o.val(),10)||1;var l=parseInt(jQuery(this).find("[name=id]").val(),10);var m=0;switch(c.limitPer){case"product":m=d[a]||0;break;case"variant":m=e[l]||0;break;case"order":m=h;break}var n=c.limitQuantity-m;n=Math.min(n,q);if(n<0){n=0}if(o.size()===0){jQuery(this).append('<input type="hidden" name="quantity" value="'+n+'"></input')}else{if(o.is("select")&&n===0){o.attr("disabled","disabled");jQuery(this).append('<input type="hidden" name="quantity" value="0"></input')}else{o.val(n)}}}if(c.limitSkipCartPage){jQuery(this).append('<input type="hidden" name="return_to" value="/checkout"></input>')}return true});jQuery("[name^=updates]").change(function(){var m=parseInt(jQuery(this).attr("id").replace("updates_",""),10);if(b(f[m])){var n=parseInt(jQuery(this).val(),10);var l=c.limitQuantity;switch(c.limitPer){case"product":l-=d[f[m]];l+=e[m];if(n>l){jQuery(this).val(l)}break;case"variant":if(n>c.limitQuantity){jQuery(this).val(c.limitQuantity)}break;case"order":l-=h;l+=e[m];if(n>l){jQuery(this).val(l)}break}}jQuery('form[action="/cart"]').get(0).submit()})})};return{configure:function(l){l=l||{};if(typeof l.limitQuantity!=="undefined"){l.limitQuantity=parseInt(l.limitQuantity,10);if(isNaN(l.limitQuantity)){l.limitQuantity=1}}if(typeof l.limitPer!=="undefined"){var k=["product","variant","order"];if(jQuery.inArray(l.limitPer,k)===-1){l.limitPer="product"}}if(typeof l.limitProductHandles!=="undefined"){if(!g(l.limitProductHandles)){l.limitProductHandles=jQuery.trim(l.limitProductHandles.toString()).split(/[\s,;]+/)}if(l.limitProductHandles[0]===""){l.limitProductHandles=[]}}if(typeof l.limitSkipCartPage!=="boolean"){l.limitSkipCartPage=false}jQuery.extend(c,l);i()},getConfig:function(){return c},getLimitQuantity:function(){return c.limitQuantity},getLimitPer:function(){return c.limitPer},getLimitProductHandles:function(){return c.limitProductHandles},getLimitSkipCartPage:function(){return c.limitSkipCartPage}}})();